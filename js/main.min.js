function startApp(){model.initMap()}function mapsError(){model.showGoogleAlert(!0),model.alertText("Oops! Google Maps Has Encountered An Error.")}var Location=function(e){this.name=ko.observable(e.name),this.city=ko.observable(e.city),this.street=ko.observable(e.street),this.category=ko.observable(e.category),this.categoryID=e.categoryID,this.foursquareID=e.foursquareID,this.iconLink=e.iconLink,this.location=e.location,this.rating=ko.observable(e.rating),this.latestTip=ko.observable(e.latestTip),this.bestPhotoLink=ko.observable(e.bestPhotoLink),this.marker,this.address=this.street()+" "+this.city()};Location.prototype.addExtraData=function(e){this.rating(e.rating),this.latestTip(e.latestTip),this.bestPhotoLink(e.bestPhotoLink)};var ViewModel=function(){function e(e,t){var o='    <div class="iw-container">    <div class="iw-name">      <h3 class="text-center">'+i.currentLocation().name()+'</h3>       <h4 class="text-center">Rating: '+i.currentLocation().rating()+'</h4>    </div>  <div class="iw-desc-container">    <div class="iw-image">      <img id="iwdescriptionimg" src="'+i.currentLocation().bestPhotoLink()+'"/>    </div>  <div class="iw-description">      <h5> Address: </h5>      <span>'+i.currentLocation().address+"</span>    </div>  </div> <div>      <h5>Latest Tip:</h5>      <span>"+i.currentLocation().latestTip()+"</span>    </div>";t.marker!=e&&(t.marker=e,t.setContent(o),t.open(a,e),t.addListener("closeclick",function(){t.marker=null,e.setAnimation(null)}))}function t(){for(var e=new google.maps.LatLngBounds,t=0;t<r.length;t++)r[t].setMap(a),e.extend(r[t].position);a.fitBounds(e)}function o(){i.locationList().forEach(function(e){i.selectedCategory()!=e.category()&&e.marker.setMap(null)})}var i=this;this.locationList=ko.observableArray([]),i.currentLocation=ko.observable(i.locationList()[0]),i.showGoogleAlert=ko.observable(!1),i.alertText=ko.observable(),i.getFourSquareLocations=function(){var e="PGZR20FMKL3MDGHKVNZFGE1N5AK02NPUCUIVQ5YFALGYSV1M",t="5LM1W4RDO2BUO24UFCLDEXFQM0DJULOMDVTRAWXC1PMSRGQQ";$.ajax({url:"https://api.foursquare.com/v2/venues/search?ll=29.739263,-90.126625&client_id=PGZR20FMKL3MDGHKVNZFGE1N5AK02NPUCUIVQ5YFALGYSV1M&client_secret=5LM1W4RDO2BUO24UFCLDEXFQM0DJULOMDVTRAWXC1PMSRGQQ&v=20160108",dataType:"json",success:function(e){for(var t=e.response.venues,o=0;o<t.length;o++){var a,n,r,s=t[o];0===s.categories.length?(a="undefined",n="",r=""):(a=s.categories[0].pluralName,n=s.categories[0].icon.prefix+"bg_32"+s.categories[0].icon.suffix,r=s.categories[0].id);var l={name:s.name,street:s.location.address,city:s.location.city,category:a,categoryID:r,foursquareID:s.id,location:{lat:s.location.lat,lng:s.location.lng},iconLink:n};i.locationList.push(new Location(l))}},error:function(e,t,o){i.alertText("Foursquare API Error: "+e.status+" "+t+" "+o),i.showGoogleAlert(!0)}}).done(function(){i.locationList().forEach(function(o){$.ajax({url:"https://api.foursquare.com/v2/venues/"+o.foursquareID+"?&client_id="+e+"&client_secret="+t+"&v=20160108",dataType:"json",success:function(e){var t,i,a,n=e.response.venue;i=void 0===n.rating?"0.0":n.rating,t=n.tips.count>0?n.tips.groups[0].items[0].text:"no tips avaialable from this location";var r={bestPhotoLink:a=void 0!==n.bestPhoto?n.bestPhoto.prefix+"300x300"+n.bestPhoto.suffix:"img/noimageavailable.gif",rating:i,latestTip:t};o.addExtraData(r)},error:function(e,t,o){i.alertText("Foursquare API Error: "+e.status+" "+t+" "+o),i.showGoogleAlert(!0)}})}),startApp()})},i.getFourSquareLocations();var a,n,r=[];i.initMap=function(){var t=new google.maps.StyledMapType([{featureType:"all",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{color:"#aadd55"}]},{featureType:"road.highway",elementType:"labels",stylers:[{visibility:"on"}]},{featureType:"road.arterial",elementType:"labels.text",stylers:[{visibility:"on"}]},{featureType:"road.local",elementType:"labels.text",stylers:[{visibility:"on"}]},{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#0099dd"}]}],{name:"Custom_Style_Map"});(a=new google.maps.Map(document.getElementById("map"),{center:{lat:40.7413549,lng:-73.9980244},zoom:13,mapTypeControlOptions:{mapTypeIds:["roadmap","satellite","hybrid","terrain","Custom_Style_Map"]}})).mapTypes.set("Custom_Style_Map",t),a.setMapTypeId("Custom_Style_Map");var o=new google.maps.InfoWindow;n=new google.maps.LatLngBounds,i.locationList().forEach(function(t){function s(){i.locationList().forEach(function(e){e.marker.setAnimation(null)}),null!==l.getAnimation()?l.setAnimation(null):l.setAnimation(google.maps.Animation.BOUNCE)}var l=new google.maps.Marker({position:t.location,map:a,title:t.name(),icon:t.iconLink});t.marker=l,r.push(l),n.extend(l.position),l.addListener("click",function(){s(),i.currentLocation(t),e(this,o)})}),a.fitBounds(n)},this.selectedCategory=ko.observable(),i.justCategories=ko.computed(function(){return ko.utils.arrayMap(i.locationList(),function(e){return e.category()}).sort()},this),i.uniqueCategories=ko.dependentObservable(function(){return ko.utils.arrayGetDistinctValues(i.justCategories()).sort()}),this.filteredLocations=ko.computed(function(){return void 0===i.selectedCategory()?i.locationList():ko.utils.arrayFilter(i.locationList(),function(e){return e.category()==i.selectedCategory()})}),this.selectionChanged=function(){void 0===this.selectedCategory()?t():(t(),o(this.selectedCategory()))},this.setLocation=function(e){i.currentLocation(e);for(var t=0;t<r.length;t++)r[t],i.currentLocation().marker,google.maps.event.trigger(e.marker,"click")}},model=new ViewModel;ko.applyBindings(model);
